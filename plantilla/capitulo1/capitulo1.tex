\chapter{Introducción}

Este proyecto de final de carrera, tiene como objetivo el estudio del comportamiento de las memorias Flash cuando han tenido un uso excesivo y su capacidad se ve afectada por la pérdida de bloques de memoria. ¿Por qué son tan importantes este tipo de memorias? 

Existen multitud de dispositivos de nuestro día a día que usan este tipo de tecnología. Tanto de uso de general, como puede ser ordenadores portátiles, discos de estado sólido (SSD), tablets, sistemas de posicionamiento global (GPS), reproductores de música, cámaras digitales, teléfonos móviles, instrumentos musicales electrónicos, decodificadores de televisión, etc. También se usan en otras muchas aplicaciones industriales, como pueden ser sistemas de seguridad, productos de redes y comunicación, productos de administración de ventas (lectores portátiles) o sistemas militares \cite{GuíaProductosMemoriaFlash}.

\section{¿Qué son las memorias Flash?}

La memoria Flash es una evolución de la memoria EEPROM, permite la lectura y escritura de múltiples posiciones de memoria en la misma operación. Gracias a ello, la tecnología Flash, permite velocidades de funcionamiento muy superiores a la tecnología EEPROM, que sólo permitía actuar sobre una única celda de memoria en cada operación de programación.

Las memorias Flash utilizan una tecnología de almacenamiento que mediante impulsos eléctricos es capaz de leer, escribir o borrar información. Estas memorias están basadas en transistores de puerta flotante que se juntan formando celdas. El elemento básico de funcionamiento de las memorias son los transistores MOS de puerta-flotante \cite{IntroductionFlash}.

Fujio Masuoka en 1984 inventó este tipo de memoria como evolución de las EEPROM existentes por aquel entonces, mientras trabajaba en Toshiba. Intel intentó atribuirse la creación sin éxito, aunque sí comercializó la primera memoria Flash de uso común en 1988 \cite{FlashMemoryWikipedia}.

Se dividen en dos clases según el tipo de puertas usado en su fabricación:
\setlength{\parskip}{0mm}
\begin{itemize}
  \item NOR: este tipo de memoria se ha usado típicamente para almacenar el software que luego es ejecutado en los dispositivos portátiles, ya que proporciona capacidades de acceso aleatorio de alta velocidad, pudiendo leer y escribir datos en lugares específicos de la memoria sin tener que acceder a la memoria en modo secuencial. A diferencia de la memoria Flash NAND, la memoria Flash NOR permite la recuperación de datos desde un solo byte. La memoria Flash NOR es excelente en aplicaciones donde los datos se recuperan o se escriben de manera aleatoria. Se encuentra integrada en teléfonos móviles (para almacenar el sistema operativo), y también se utiliza en los ordenadores para almacenar el programa BIOS que se ejecuta en el arranque.
  \item NAND: fue inventada después de la NOR. Diseñadas con unas celdas muy pequeñas, que permiten tener un precio muy pequeño por bit de almacenamiento. Por eso se encuentra comúnmente en unidades de disco duro de estado sólido y unidades de almacenamiento. La memoria Flash NAND lee y escribe a alta velocidad, en modo secuencial, manejando datos en bloques de tamaño pequeño. La memoria Flash NAND puede recuperar o escribir datos como páginas únicas, pero no puede recuperar bytes individuales como la memoria Flash NOR. La memoria Flash NAND es más económica que la memoria Flash NOR y puede guardar una mayor cantidad de datos en el mismo tamaño de bloque \ref{fig:comparacionNORNAN} \cite{GuíaProductosMemoriaFlash}.
\end{itemize}
\setlength{\parskip}{4mm}

En lo que al consumo energético se refiere, algo bastante importante dependiendo del dispositivo, es algo menor en las NAND cuando son usadas en aplicaciones que tienen mucha carga de escritura. Sin embargo el consumo instantáneo sin demasiada carga de trabajo es bastante parecido entre los dos tipos de memorias \cite{NANDvsNORFlashMemory}.

\begin{figure}[h!]
	\centering
		\includegraphics[width=0.60\textwidth]{fig/comparacionNORNAN.eps}
	\caption{\emph{Diferencia entre Flash NOR y NAND \cite{NANDvsNORFlashMemory}}.}
        \label{fig:comparacionNORNAN}
\end{figure}

En la actualidad la diferencia entre los dos tipos es cada vez menor \cite{NANDvsNORFlashMemory} \cite{FlashMemoryWikipedia}.

La memoria Flash con la que hemos trabajado ha sido es una \textit{BIWIN BW29F64G08CBABA}, que son de tipo \textit{Micron 20nm MLC Flash}. El controlador que utiliza es un \textit{Alcor AU6989ANHL}.

Por último hay que mencionar que este tipo de tecnología va a ser muy importante en el futuro, como por ejemplo en aplicaciones de automoción donde se han conseguido microcontroladores con una memoria Flash de 40nm de muy bajo consumo \cite{aplicaciones-en-automocion}. Hay también proyectos para usar las memorias Flash como RAM, pero de momento son más lentas que las DRAM, aunque puede llegar a consumir diez veces menos de energía y son algo más baratas \cite{flashram}.

\section{Motivación}

Como hemos visto anteriormente, el uso de las memorias Flash está bastante extendido. La sociedad demanda dispositivos más pequeños y rápidos y las memorias Flash se adaptan a estas necesidades. Ha habido una creciente implantación en portátiles conforme el precio por Giga byte ha ido disminuyendo \ref{fig:US-SSD-Price} \cite{priceSSDEvolution}. 

\begin{figure}[h!]
	\centering
		\includegraphics[width=0.60\textwidth,natwidth=610,natheight=642]{fig/US-SSD-Price.eps}
	\caption{\emph{Evolución de los precios de los discos SSD \cite{priceSSDEvolution}}.}
        \label{fig:US-SSD-Price}
\end{figure}

Además esta tecnología supone un ahorro energético, algo también muy importante en dispositivos móviles o portables. En un artículo de la web \url{www.anandtech.com} realizan una comparación con un MacBook Air usando un disco sólido y un disco magnético. En sus resultados puede verse una diferencia en el consumo energético de 0.9W en el HDD en lectura y escritura frente a 0.24/0.32W del SSD, o de un 16.8\% más de batería usando el portátil para navegar por internet y escuchar música. El único punto donde la memoria Flash pierde es en el consumo hibernando, en que el disco duro no consume energía y el disco sólido 0.015W \cite{SSDonBatteryLife}.

De momento solo hemos contado las virtudes de esta tecnología, pero las memorias Flash tienen un problema: cada bloque de memoria soporta unos ciclos de escritura/borrado. Nadie quiere estar haciendo fotos con su cámara digital y que un buen día haya fotos que se pierdan, o comprarse un disco sólido de una capacidad y que después de un tiempo esa capacidad se haya visto reducida sensiblemente. Todo esto nos hace plantearnos las siguientes preguntas: ¿qué pasa cuando se usa más veces de las soportadas?, ¿cuántos ciclos son los realmente soportados?, ¿qué información queda si un bloque se rompe?, y, ¿se puede recuperar la información que había?

Normalmente en la mayoría de los dispositivos con memorias Flash, el chip de memoria va acompañado de un controlador. Éste procesa los datos en la lectura y la escritura. Su presencia supondrá un problema añadido porque existirá una diferencia entre los datos que se ven desde fuera al utilizar el dispositivo, que han sido procesados por el controlador, y los datos presentes que están realmente en el chip de memoria \cite{ArchitectureForuniversal}.

En este proyecto hemos tratado de profundizar sobre funcionamiento de las memorias flash, sobre todo en lo que se refiere al funcionamiento interno, a bajo nivel, pero sin entrar en el hardware. En qué posiciones de memoria guarda la tabla de nombres, cómo gestiona los archivos, cuál es el tamaño que tiene un sector, cuántos ciclos de vida útil tiene un sector y qué información queda cuando un sector se deteriora.

Para ello hemos realizado varios experimentos, los cuales detallamos en el Capítulo \ref{chap:cap3}.

\section{Objetivos}

\begin{itemize}
\item  \textbf{Determinar el tamaño de sector en hardware y software}: hay que diferenciar entre lo que el sistema ve y lo que realmente está guardado en memoria. El sistema de ficheros puede tener un tamaño de bloque distinto del que físicamente tiene la memoria.
\item  \textbf{Determinar como funciona la tabla de nombres}: en la tabla de nombres están los nombres de los ficheros que tiene guardados la memoria, ¿se guarda también un puntero al fichero? ¿esta tabla tiene algún formato especial?, son algunas de las preguntas que intentaremos resolver en este apartado.
\item  \textbf{¿El controlador mueve datos entre bloques para alargar la vida de los mismos?}: cada bloque tiene unos ciclos de vida, si solo unos pocos están libres y siempre se usan los mismos, ¿puede el controlador mover datos a bloques que estén menos ``gastados''?
  \begin{itemize}
  \item  \textbf{¿Un borrado implica cambios ``físicos''?}: Cuando se borra un fichero desde el sistema operativo, sus datos siguen existiendo hasta que se sobreescribe, ¿se borra también su referencia en la tabla de nombres?
  \item  \textbf{¿El montar y desmontar un dispositivo implica movimiento de datos?}: Puede pasar que el supuesto movimiento de datos al que nos referíamos antes pase en el montado y desmontado del dispositivo.
  \end{itemize}
\item  \textbf{Determinar la vida útil (ciclos de vida) de un sector}: cada bloque de memoria tiene unos ciclos de borrado/escritura. Vamos a determinar cuantos ciclos aguanta un bloque.
\item  \textbf{Ver que información queda después en un sector roto}: una vez que un bloque de memoria deja de estar reconocible por el sistema, ¿queda algún tipo de información útil en él?
\end{itemize}
